---
title: "Shootings within South Bend School Boundries"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(jsonlite)
library(maptools)
library(ggplot2)
library(tidyr)
library(dplyr)
library(purrr)
library(leaflet)
library(sf)

# 
# sb_elem <- st_read("South_Bend_Elementary_School_District_Boundaries.shp") %>%
#   select(SchoolName) %>%
#   mutate(Type="Elementary")
# sb_middle <- st_read("South_Bend_Middle_School_District_Boundaries.shp")%>%
#   select(SchoolName) %>%
#   mutate(Type="Middle")
# sb_high <- st_read("South_Bend_High_School_District_Boundaries.shp") %>%
#   select(SchoolName) %>%
#   mutate(Type="High")
# 
# schools <- rbind(sb_elem, sb_middle, sb_high)
# 
# shootings <- st_read("Criminally_Assaulted_Shootings.shp")
# 
# classify_df <- shootings %>%
#   select(USER_Year, USER_Fatal)
# 
# 
# remote_data <- st_join(x = schools, classify_df) %>%
#   group_by(SchoolName, Type, USER_Year)
# 
# save(shootings, remote_data, file="remote_data.rda")
load('remote_data.rda')

remote_data.df <- remote_data %>% st_set_geometry(NULL)
shootings.df <- shootings %>% st_set_geometry(NULL)
```

Sidebar {.sidebar}
=======================================================================

### <strong>Dashboard Controls<strong>


```{r}
selectInput(inputId = "year", label = h3("Years"), 
            choices = list("2015" = 2015, "2016" = 2016, "2017" = 2017, "2018" = 2018, "2019" = 2019), selected = 2019)

selectInput(inputId = "fatal", label = h3("Shooting"), 
            choices = list("Yes" = "Yes", "No" = "No", "All" = "All"), selected = "All")

selectInput(inputId = "school", label = h3("School Boundries"), 
            choices = list("Elementary School" = 'Elementary', 
                           "Middle School" = "Middle", 
                           "High School" = "High"), selected = 1)

```


Dashboard
=======================================================================

Row
-----------------------------------------------------------------------

### Total Shootings {.value-box}

```{r}

total.shootings <- reactive({
  shootings.df %>% 
    filter(USER_Year == input$year) %>% 
    group_by(USER_Year) %>% 
    summarise(count=n()) %>%
    .$count %>% 
    return()
})


renderValueBox({

  
  valueBox(
    value = total.shootings(),
    #icon = "fa-area-chart",
    #color = if (rate >= input$rateThreshold) "warning" else "primary"
  )
})
```

### Proportion Fatal {.value-box}

```{r}
total.fatal <- reactive({
  tmp <- shootings.df %>% 
    filter(USER_Year == input$year, USER_Fatal == 'Yes') %>% 
    group_by(USER_Year) %>% 
    summarise(count=n()) %>%
    .$count %>% 
    return()
})


renderValueBox({

  
  valueBox(
    value = paste0(round((total.fatal() / total.shootings())*100,1),"%"),
    #icon = "fa-area-chart",
    #color = if (rate >= input$rateThreshold) "warning" else "primary"
  )
})
```

### Unique users {.value-box}

```{r}

```

Row
-----------------------------------------------------------------------

### Popularity by package (last 5 min) {data-width=700}

```{r}

```

### Percent of downloads (last 5 min) {data-width=340}

```{r}

```

Recent Downloads
=======================================================================

### Recent Downlads

```{r}

```

